#!/usr/bin/env bash

set -euo pipefail


function push() {
    rclone sync \
           --dry-run \
           --verbose \
           --track-renames \
           --backup-dir "rclone-backup/$(date +%Y-%m-%d)" \
           --password-command "op read op://personal/Rclone/password" \
           ~/Documents/notes notes-rosstimson:notes-rosstimson

    echo "Above is a dry run. Continue with actual sync? (y/N)"
    read -r response
    if [[ "$response" =~ ^[Yy]$ ]]; then
        rclone sync \
               --interactive \
               --update \
               --verbose \
               --track-renames \
               --backup-dir "rclone-backup/$(date +%Y-%m-%d)" \
               --password-command "op read op://personal/Rclone/password" \
               ~/Documents/notes notes-rosstimson:notes-rosstimson
    fi
}


function pull() {
	rclone sync \
		   --interactive \
		   --update \
		   --verbose \
		   --password-command "op read op://personal/Rclone/password" \
		   notes-rosstimson:notes-rosstimson ~/Documents/notes
}


# Default to pull if no arguments given
case ${1:-pull} in
    push)
        push
        ;;
    pull)
        pull
        ;;
    *)
        echo "Invalid argument. Usage: $0 [push|pull]"
        exit 1
        ;;
esac

exit 0
