#!/usr/bin/env bash

set -euxo pipefail

export AWS_ACCESS_KEY_ID="$(op read 'op://personal/Restic Backup/aws_access_key_id')"
export AWS_SECRET_ACCESS_KEY="$(op read 'op://personal/Restic Backup/aws_secret_access_key')"

export RESTIC_REPOSITORY="s3:s3.us-east-005.backblazeb2.com/rosstimson-backup/laptop"
export RESTIC_PASSWORD_COMMAND="op read 'op://personal/Restic Backup/password'"


restic backup \
	   --exclude-caches \
	   --one-file-system \
	   --cleanup-cache \
	   --files-from ~/.config/restic/default-include.txt \
	   --exclude-file ~/.config/restic/global-exclude.txt
